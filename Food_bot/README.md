# FoodBot – бот для заказа обедов

Этот проект представляет собой Telegram-бота на базе [aiogram 3](https://docs.aiogram.dev/), позволяющего:

* регистрировать сотрудников;
* назначать администраторов;
* вести справочник столовых ("кантин") и блюд;
* принимать заказы;
* формировать отчёты в формате Excel;
* экспортировать статистику;
* управлять пользователями через встроенную панель администратора.

---

## Быстрый старт

1. **Клонируйте репозиторий и создайте виртуальное окружение** (Python 3.12 рекомендуется):

```bash
python -m venv .venv
source .venv/bin/activate  # Windows: .venv\Scripts\activate
```

2. **Установите зависимости**:

```bash
pip install -r requirements.txt
```

3. **Скопируйте файл `.env` и укажите переменные окружения**:

```bash
cp example.env .env
```

Отредактируйте `.env`, подставив свой токен бота и при необходимости логины администраторов (через пробел или перевод строки):

```dotenv
BOT_TOKEN="123456:ABC-DEF…"
ADMIN_USERNAMES="@my_admin @another_admin"
DATABASE_URL="sqlite+aiosqlite:///./foodbot.db"  # путь к БД (можно PostgreSQL)
```

4. **Запустите бота**:

```bash
python -m foodbot.main
```

Бот начинает long-polling и готов принимать команды `/start`, `/register` и т.д.

---

## Структура проекта

```
foodbot/
├── __init__.py         # инициализация пакета
├── config.py           # чтение .env через pydantic-settings
├── database.py         # создание движка SQLAlchemy + миграции
├── models.py           # модели SQLModel (User, Canteen, …)
├── main.py             # точка входа, регистрация роутеров
└── routers/            # бизнес-логика бота
    ├── registration.py # регистрация пользователей
    ├── admin.py        # панель администратора + отчёты
    └── ordering.py     # выбор столовой/блюда, оформление заказа
```

---

## Использование PostgreSQL (опционально)

Проект по умолчанию использует SQLite (файл `foodbot.db`). Чтобы переключиться на PostgreSQL:

1. Установите драйвер `asyncpg`:

```bash
pip install asyncpg
```

2. Измените `DATABASE_URL` в `.env`, например:

```
DATABASE_URL="postgresql+asyncpg://user:password@localhost:5432/foodbot"
```

3. При первом запуске таблицы будут созданы автоматически.

---

## Дополнительные команды

* `/admin` – открыть панель администратора
* В панели доступны:
  * управление пользователями, столовыми, блюдами;
  * выгрузка отчёта за сегодня (`.xlsx`);
  * опрос на выбор блюда («голосовалка»).

---
